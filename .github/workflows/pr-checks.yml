name: Pull Request Checks

on:
  pull_request:
    branches: [ main ]
    types: [opened, synchronize, reopened]

jobs:
  pr-info:
    name: PR Information
    runs-on: ubuntu-latest
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      with:
        fetch-depth: 0

    - name: Get changed files
      id: changed-files
      uses: tj-actions/changed-files@v45
      with:
        files: |
          **/*.java
          **/pom.xml

    - name: List changed files
      run: |
        echo "## Changed Files :file_folder:" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "### Java and Maven files modified:" >> $GITHUB_STEP_SUMMARY
        for file in ${{ steps.changed-files.outputs.all_changed_files }}; do
          echo "- $file" >> $GITHUB_STEP_SUMMARY
        done

  code-style:
    name: Code Style Check
    runs-on: ubuntu-latest
    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Set up JDK 17
      uses: actions/setup-java@v4
      with:
        java-version: '17'
        distribution: 'temurin'
        cache: 'maven'

    - name: Check code formatting
      run: |
        echo "## Code Style :art:" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "✅ Code style check passed" >> $GITHUB_STEP_SUMMARY

  build-check:
    name: Build Verification
    runs-on: ubuntu-latest
    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Set up JDK 17
      uses: actions/setup-java@v4
      with:
        java-version: '17'
        distribution: 'temurin'
        cache: 'maven'

    - name: Verify build
      run: mvn clean verify -B

    - name: Comment PR
      uses: actions/github-script@v7
      if: always()
      with:
        script: |
          github.rest.issues.createComment({
            issue_number: context.issue.number,
            owner: context.repo.owner,
            repo: context.repo.repo,
            body: '✅ Build verification completed successfully!'
          })
